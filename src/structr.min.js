var Structr=function(a,c){c||(c=Structr.fh());var b=Structr.extend(c,a);if(!b.__construct)b.__construct=function(){};b.__construct.prototype=b;b.__construct.extend=function(a){return Structr.closure(a,b)};b.__construct.replace=function(a){Structr.replace(b,a)};return b.__construct};Structr.copy=function(a,c,b){c||(c={});for(var d in a){var h=a[d],g=c[d];typeof h=="object"?(g=g&&h instanceof g.constructor?g:h instanceof Array?[]:{},Structr.copy(h,g,b)):g=h;c[d]=g}return c};
Structr.setPrivate=function(a,c,b){var d=a.__private[c];if(d&&d.isFinal)throw Error('property "'+c+'" cannot be overridden.');a.__private[c]=b};Structr.getNArgs=function(a){return(a=a.toString().replace(/\{[\W\S]+\}/g,"").match(/\w+(?=[,\)])/g))?a.length:0};Structr.setNewProperty=function(a,c,b){Structr.setPrivate(a,c,b);a[c]=b};Structr.getMethod=function(a,c){return function(){return a[c].apply(a,arguments)}};Structr.findProperties=function(a,c){var b=[],d;for(d in a){var h=a[d];h&&h[c]&&b.push(d)}return b};
Structr.singletonGet=function(a){return{get:function(){return this._value||(this._value=new a)}}};
Structr.modifiers={m_override:function(a,c,b){var d=a.__private&&a.__private[c]||a[c]||function(){};return function(){this._super=d;var a=b.apply(this,arguments);delete this._super;return a}},m_decorate:function(a,c,b){var d=a.__private&&a.__private[c]||a[c]||function(){};return function(){d.apply(this,arguments);return b.apply(this,arguments)}},m_abstract:function(a,c,b){var d=Structr.getNArgs(b);b.testAbstract=function(b){var g=Structr.getNArgs(b);if(d!=g)throw Error('overridden method "'+c+'" has '+
g+" arguments, expected "+d);a[c]=b};return b},m_final:function(a,c,b){b.isFinal=!0;return b},m_explicit:function(a,c,b){var d="_gs::"+c;typeof b!="object"&&(b={});if(!b.get)b.get=function(){return this._value};if(!b.set)b.set=function(b){this._value=b};return function(a){if(arguments.length){if(this[d]!=a)this._value=this[d],b.set.apply(this,[a]),this[d]=this._value}else{this._value=this[d];var c=b.get.apply(this);delete this._value;return c}}},m_implicit:function(a,c,b){Structr.setPrivate(a,c,b);
a.__defineGetter__(c,b);a.__defineSetter__(c,b)}};
Structr.extend=function(a,c){c||(c={});var b={__private:{propertyModifiers:{}}};c instanceof Function&&(c=c());Structr.copy(a,b,!0);var d=Structr.modifier,h={},g;for(g in c){var e=c[g],i=g.split(" "),f=i.pop(),k=b.__private.propertyModifiers[f]||(b.__private.propertyModifiers[f]=[]);h[f]=1;if(i.length){for(var j={},l=i.length;l--;){var m=i[l];j["m_"+i[l]]=1;k.indexOf(m)==-1&&k.push(m)}j.m_abstract&&(e=d.m_abstract(b,f,e));j.m_final&&(e=d.m_final(b,f,e));if(j.m_explicit||j.m_implicit)e=d.m_explicit(b,
f,e);j.m_override?e=d.m_override(b,f,e):j.m_decorate&&(e=d.m_decorate(b,f,e));if(j.m_implicit){d.m_implicit(b,f,e);continue}}for(i=k.length;i--;)e[k[i]]=!0;Structr.setNewProperty(b,f,e)}if(b.__construct&&a.__construct&&b.__construct==a.__construct)b.__construct=Structr.modifier.m_decorate(b,"__construct",function(){});for(f in b){if((e=b[f])&&e["static"])b.__construct[f]=e,delete b[f];if(!h[f]&&e&&e.testAbstract)throw Error('"'+f+'" must be overridden.');}return b};
Structr.extend=function(a,c){Structr.copy(Structr.extend(a,c),a)};Structr.replace=function(a,c){Structr.copy(Structr.extend(a,c),a)};Structr.fh=function(a){a||(a={});a=Structr.extend({},a);a.getMethod=function(a){return Structr.getMethod(this,a)};a.extend=function(a){return Structr.extend(this,a)};a.copyTo=function(a){Structr.copy(this,a,!0)};a.replace=function(a){return Structr.replace(this,a)};return a};